<html>
	<head>
		<title>Davis</title>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
		<style>body {
    margin: 0;
    padding: 0;
    font: 14px/1.5 'Palatino Linotype', 'Book Antiqua', Palatino, FreeSerif, serif;
    color: #252519;
}
a {
    color: #252519;
}
a:hover {
    text-decoration: underline;
    color: #19469D;
}
p {
    margin: 12px 0;
}
h1, h2, h3 {
    margin: 0;
    padding: 0;
}
table#source {
    width: 100%;
    border-collapse: collapse;
}
table#source td:first-child {
    padding: 30px 40px 30px 40px;
    vertical-align: top;
}
table#source td:first-child,
table#source td:first-child pre {
    width: 450px;
}
table#source td:last-child {
    padding: 30px 0 30px 40px;
    border-left: 1px solid #E5E5EE;
    background: #F5F5FF;
}
table#source tr {
    border-bottom: 1px solid #E5E5EE;
}
table#source tr.filename {
    padding-top: 40px;
    border-top: 1px solid #E5E5EE;
}
table#source tr.filename td:first-child {
    text-transform: capitalize;
}
table#source tr.filename td:last-child {
    font-size: 12px;
}
table#source tr.filename h2 {
    margin: 0;
    padding: 0;
    cursor: pointer;
}
table#source tr.code h1,
table#source tr.code h2,
table#source tr.code h3 {
    margin-top: 30px;
    font-family: "Lucida Grande", "Helvetica Nueue", Arial, sans-serif;
    font-size: 18px;
}
table#source tr.code h2 {
    font-size: 16px;
}
table#source tr.code h3 {
    font-size: 14px;
}
table#source tr.code ul {
    margin: 15px 0 15px 35px;
    padding: 0;
}
table#source tr.code ul li {
    margin: 0;
    padding: 1px 0;
}
table#source tr.code ul li p {
    margin: 0;
    padding: 0;
}
table#source tr.code td:first-child pre {
    padding: 20px;
}
#ribbon {
    position: fixed;
    top: 0;
    right: 0;
}
code .string { color: #219161; }
code .regexp { color: #219161; }
code .keyword { color: #954121; }
code .number { color: #19469D; }
code .comment { color: #bbb; }
code .this { color: #19469D; }</style>
		<script>
			$(function(){
				$('tr.code').hide();
				$('tr.filename').toggle(function(){
					$(this).nextUntil('.filename').fadeIn();
				}, function(){
					$(this).nextUntil('.filename').fadeOut();
				});
			});
		</script>
	</head>
	<body>
<table id="source"><tbody><tr><td><h1>Davis</h1></td><td></td></tr><tr class="filename"><td><h2 id="src/davis.app.js"><a href="#">davis.app</a></h2></td><td>src/davis.app.js</td></tr><tr class="code">
<td class="docs">
<p>Constructor for Davis.App
 - <strong>constructo</strong>: <em>r</em></p>

<h2></h2>

<ul><li><p><strong>returns</strong>: <em>Davis.App</em> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">App</span> = <span class="keyword">function</span> () {
    <span class="this">this</span>.<span class="variable">id</span> = [<span class="keyword">new</span> <span class="class">Date</span>().<span class="variable">valueOf</span>(), <span class="variable">appCounter</span>++].<span class="variable">join</span>(&<span class="variable">quot</span>;-&<span class="variable">quot</span>;);
    <span class="this">this</span>.<span class="variable">running</span> = <span class="variable">false</span>;
    <span class="this">this</span>.<span class="variable">boundToInternalEvents</span> = <span class="variable">false</span>;
  };</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>app.configure</h2>

<p>A convinience function for changing the apps default settings.
Should be used before starting the app to ensure any new settings
are picked up and used.</p>

<h2></h2>

<ul><li><strong>param</strong>: <em>Function</em>  config - This function will be executed with the context bound to the apps setting object, this will also be passed as the first argument to the function.</li></ul>

<h3>Example:</h3>

<pre><code>app.configure(function (config) {
  config.linkSelector = 'a.davis'
  config.formSelector = 'form.davis'
})
 </code></pre>
</td>
<td class="code">
<pre><code><span class="variable">configure</span>: <span class="keyword">function</span> (<span class="variable">config</span>) {
      <span class="variable">config</span>.<span class="variable">call</span>(<span class="this">this</span>.<span class="variable">settings</span>, <span class="this">this</span>.<span class="variable">settings</span>);
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>app.use</h2>

<p>Method to include a plugin in this app.  A plugin is just a function that will be evaluated in the
context of the app.</p>

<h2></h2>

<ul><li><strong>param</strong>: <em>Function</em>  plugin - The plugin to use</li></ul>

<h3>Example:</h3>

<pre><code>app.use(Davis.title)

 </code></pre>
</td>
<td class="code">
<pre><code><span class="variable">use</span>: <span class="keyword">function</span> (<span class="variable">plugin</span>) {
      <span class="variable">plugin</span>.<span class="variable">apply</span>(<span class="this">this</span>, <span class="class">Davis</span>.<span class="variable">utils</span>.<span class="variable">toArray</span>(<span class="variable">arguments</span>, <span class="number integer">1</span>))
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>app.helpers</h2>

<p>Method to add helper properties to all requests in the application.  Helpers will be added to the
Davis.Request.prototype.  Care should be taken not to override any existing Davis.Request methods.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  helpers - An object containing helpers to mixin to the request</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">helpers</span>: <span class="keyword">function</span> (<span class="variable">helpers</span>) {
      <span class="keyword">for</span> (<span class="variable">property</span> <span class="keyword">in</span> <span class="variable">helpers</span>) {
        <span class="keyword">if</span> (<span class="variable">helpers</span>.<span class="variable">hasOwnProperty</span>(<span class="variable">property</span>)) <span class="class">Davis</span>.<span class="class">Request</span>.<span class="variable">prototype</span>[<span class="variable">property</span>] = <span class="variable">helpers</span>[<span class="variable">property</span>]
      }
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>app.settings</h2>

<p>Settings for the app.  These may be overriden directly or by using the configure
convinience method.</p>

<p><code>linkSelector</code> is the jquery selector for all the links on the page that you want
Davis to respond to.  These links will not trigger a normal http request.</p>

<p><code>formSelector</code> is similar to link selector but for all the forms that davis will bind to</p>

<p><code>logger</code> is the object that the app will use to log through.</p>

<p><code>throwErrors</code> decides whether or not any errors will be caugth by Davis.  If this is set to true
errors will be thrown so that the request will not be handled by JavaScript, the server will have
to provide a response.  When set to false errors in a route will be caught and the server will not
receive the request.</p>

<p><code>handleRouteNotFound</code> determines whether or not Davis should handle requests when there is no matching
route.  If set to false Davis will allow the request to be passed to your server to handle if no matching
route can be found.</p>

<p><code>generateRequestOnPageLoad</code> determines whether a request should be generated for the initial page load.
by default this is set to true so that a Davis.Request will be generated with the path of the current
page.  Setting this to false will prevent a request being passed to your app for the inital page load.</p>

<ul><li><strong>se</strong>: <em>e</em>
#configure
 </li></ul>
</td>
<td class="code">
<pre><code><span class="variable">settings</span>: {
      <span class="variable">linkSelector</span>: <span class="string">'a'</span>,
      <span class="variable">formSelector</span>: <span class="string">'form'</span>,
      <span class="variable">logger</span>: <span class="class">Davis</span>.<span class="variable">logger</span>,
      <span class="variable">throwErrors</span>: <span class="variable">true</span>,
      <span class="variable">handleRouteNotFound</span>: <span class="variable">false</span>,
      <span class="variable">generateRequestOnPageLoad</span>: <span class="variable">true</span>
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>app.start</h2>

<p>Once the app's routes have been defined and any additional configuration has happened the 
start method should be called.</p>

<p>Starting the app binds all links and forms, so clicks and submits
create Davis requests that will be pushed onto the browsers history stack.  Browser history change
events will be picked up and the request that caused the change will be matched against the apps
routes and filters.
     </p>
</td>
<td class="code">
<pre><code><span class="variable">start</span>: <span class="keyword">function</span> () {
      <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;

      <span class="keyword">if</span> (!<span class="class">Davis</span>.<span class="variable">supported</span>()) {
        <span class="this">this</span>.<span class="variable">trigger</span>(<span class="string">'unsupported'</span>)
        <span class="keyword">return</span>
      };

      <span class="keyword">var</span> <span class="variable">runFilterWith</span> = <span class="keyword">function</span> (<span class="variable">request</span>) {
        <span class="keyword">return</span> <span class="keyword">function</span> (<span class="variable">filter</span>) {
          <span class="keyword">var</span> <span class="variable">result</span> = <span class="variable">filter</span>.<span class="variable">run</span>(<span class="variable">request</span>, <span class="variable">request</span>);
          <span class="keyword">return</span> (<span class="keyword">typeof</span> <span class="variable">result</span> === &<span class="variable">quot</span>;<span class="variable">undefined</span>&<span class="variable">quot</span>; || <span class="variable">result</span>);
        }
      }

      <span class="keyword">var</span> <span class="variable">beforeFiltersPass</span> = <span class="keyword">function</span> (<span class="variable">request</span>) {
        <span class="keyword">return</span> <span class="class">Davis</span>.<span class="variable">utils</span>.<span class="variable">every</span>(
          <span class="variable">self</span>.<span class="variable">lookupBeforeFilter</span>(<span class="variable">request</span>.<span class="variable">method</span>, <span class="variable">request</span>.<span class="variable">path</span>),
          <span class="variable">runFilterWith</span>(<span class="variable">request</span>)
        )
      }

      <span class="keyword">var</span> <span class="variable">handleRequest</span> = <span class="keyword">function</span> (<span class="variable">request</span>) {
        <span class="keyword">if</span> (<span class="variable">beforeFiltersPass</span>(<span class="variable">request</span>)) {
          <span class="variable">self</span>.<span class="variable">trigger</span>(<span class="string">'lookupRoute'</span>, <span class="variable">request</span>)
          <span class="keyword">var</span> <span class="variable">route</span> = <span class="variable">self</span>.<span class="variable">lookupRoute</span>(<span class="variable">request</span>.<span class="variable">method</span>, <span class="variable">request</span>.<span class="variable">path</span>);
          <span class="keyword">if</span> (<span class="variable">route</span>) {
            <span class="variable">self</span>.<span class="variable">trigger</span>(<span class="string">'runRoute'</span>, <span class="variable">request</span>, <span class="variable">route</span>);

            <span class="keyword">try</span> {
              <span class="variable">route</span>.<span class="variable">run</span>(<span class="variable">request</span>)
              <span class="variable">self</span>.<span class="variable">trigger</span>(<span class="string">'routeComplete'</span>, <span class="variable">request</span>, <span class="variable">route</span>)
            } <span class="keyword">catch</span> (<span class="variable">error</span>) {
              <span class="variable">self</span>.<span class="variable">trigger</span>(<span class="string">'routeError'</span>, <span class="variable">request</span>, <span class="variable">route</span>, <span class="variable">error</span>)
            }

            <span class="class">Davis</span>.<span class="variable">utils</span>.<span class="variable">every</span>(
              <span class="variable">self</span>.<span class="variable">lookupAfterFilter</span>(<span class="variable">request</span>.<span class="variable">method</span>, <span class="variable">request</span>.<span class="variable">path</span>),
              <span class="variable">runFilterWith</span>(<span class="variable">request</span>)
            );

          } <span class="keyword">else</span> {
            <span class="variable">self</span>.<span class="variable">trigger</span>(<span class="string">'routeNotFound'</span>, <span class="variable">request</span>);
          }
        } <span class="keyword">else</span> {
          <span class="variable">self</span>.<span class="variable">trigger</span>(<span class="string">'requestHalted'</span>, <span class="variable">request</span>)
        }
      }

      <span class="keyword">var</span> <span class="variable">bindToInternalEvents</span> = <span class="keyword">function</span> () {
        <span class="variable">self</span>
          .<span class="variable">bind</span>(<span class="string">'runRoute'</span>, <span class="keyword">function</span> (<span class="variable">request</span>) {
            <span class="variable">self</span>.<span class="variable">settings</span>.<span class="variable">logger</span>.<span class="variable">info</span>(&<span class="variable">quot</span>;<span class="variable">runRoute</span>: &<span class="variable">quot</span>; + <span class="variable">request</span>.<span class="variable">toString</span>());
          })
          .<span class="variable">bind</span>(<span class="string">'routeNotFound'</span>, <span class="keyword">function</span> (<span class="variable">request</span>) {
            <span class="keyword">if</span> (!<span class="variable">self</span>.<span class="variable">settings</span>.<span class="variable">handleRouteNotFound</span> &<span class="variable">amp</span>;&<span class="variable">amp</span>; !<span class="variable">request</span>.<span class="variable">isForPageLoad</span>) {
              <span class="variable">self</span>.<span class="variable">stop</span>()
              <span class="variable">request</span>.<span class="variable">delegateToServer</span>()
            };
            <span class="variable">self</span>.<span class="variable">settings</span>.<span class="variable">logger</span>.<span class="variable">warn</span>(&<span class="variable">quot</span>;<span class="variable">routeNotFound</span>: &<span class="variable">quot</span>; + <span class="variable">request</span>.<span class="variable">toString</span>());
          })
          .<span class="variable">bind</span>(<span class="string">'start'</span>, <span class="keyword">function</span> () {
            <span class="variable">self</span>.<span class="variable">settings</span>.<span class="variable">logger</span>.<span class="variable">info</span>(&<span class="variable">quot</span>;<span class="variable">application</span> <span class="variable">started</span>&<span class="variable">quot</span>;)
          })
          .<span class="variable">bind</span>(<span class="string">'stop'</span>, <span class="keyword">function</span> () {
            <span class="variable">self</span>.<span class="variable">settings</span>.<span class="variable">logger</span>.<span class="variable">info</span>(&<span class="variable">quot</span>;<span class="variable">application</span> <span class="variable">stopped</span>&<span class="variable">quot</span>;)
          })
          .<span class="variable">bind</span>(<span class="string">'routeError'</span>, <span class="keyword">function</span> (<span class="variable">request</span>, <span class="variable">route</span>, <span class="variable">error</span>) {
            <span class="keyword">if</span> (<span class="variable">self</span>.<span class="variable">settings</span>.<span class="variable">throwErrors</span>) <span class="keyword">throw</span>(<span class="variable">error</span>)
            <span class="variable">self</span>.<span class="variable">settings</span>.<span class="variable">logger</span>.<span class="variable">error</span>(<span class="variable">error</span>.<span class="variable">message</span>, <span class="variable">error</span>.<span class="variable">stack</span>)
          });

        <span class="class">Davis</span>.<span class="variable">location</span>.<span class="variable">onChange</span>(<span class="keyword">function</span> (<span class="variable">req</span>) {
          <span class="variable">handleRequest</span>(<span class="variable">req</span>)
        });

        <span class="variable">self</span>.<span class="variable">boundToInternalEvents</span> = <span class="variable">true</span>
      }

      <span class="keyword">if</span> (!<span class="this">this</span>.<span class="variable">boundToInternalEvents</span>) <span class="variable">bindToInternalEvents</span>()

      <span class="this">this</span>.<span class="variable">listen</span>();
      <span class="this">this</span>.<span class="variable">trigger</span>(<span class="string">'start'</span>)
      <span class="this">this</span>.<span class="variable">running</span> = <span class="variable">true</span>;

      <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">settings</span>.<span class="variable">generateRequestOnPageLoad</span>) <span class="variable">handleRequest</span>(<span class="class">Davis</span>.<span class="class">Request</span>.<span class="variable">forPageLoad</span>())

    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>app.stop</h2>

<p>Stops the app listening to clicks and submits on all forms and links found using the current
apps settings.
     </p>
</td>
<td class="code">
<pre><code><span class="variable">stop</span>: <span class="keyword">function</span> () {
      <span class="this">this</span>.<span class="variable">unlisten</span>();
      <span class="this">this</span>.<span class="variable">trigger</span>(<span class="string">'stop'</span>)
      <span class="this">this</span>.<span class="variable">running</span> = <span class="variable">false</span>
    }</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="src/davis.event.js"><a href="#">davis.event</a></h2></td><td>src/davis.event.js</td></tr><tr class="code">
<td class="docs">
<p>A module that can be mixed into any object to provide basic event functionality.
This module is mixed into the prototype of Davis.App.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Davis</span>.<span class="variable">event</span> = {</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>app.bind</h2>

<p>Binds a callback to a named event.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  eventName</p></li><li><p><strong>param</strong>: <em>Function</em>  callback</p></li></ul>

<p>The callback will be called with its context set to which ever object this module
has been mixed into.  Any data that is passed when triggering the event will be passed
to the callback function as the first parameter.</p>

<p>The following events are triggered internally by Davis and can be bound to:</p>

<p> <strong>start</strong> : Triggered when the application is started</p>

<p> <strong>lookupRoute</strong> : Triggered before looking up a route, the request being looked up is passed as an argument</p>

<p> <strong>runRoute</strong> : Triggered before running a route, the request and route being run are passed as arguments</p>

<p> <strong>routeNotFound</strong> : Triggered if no route for the current request can be found, the current request is passed as an arugment</p>

<p> <strong>requestHalted</strong> : Triggered when a before filter halts the current request, the current request is passed as an argument</p>

<p> <strong>unsupported</strong> : Triggered when starting a Davis app in a browser that doesn't support html5 pushState</p>

<h3>Example:</h3>

<pre><code>app.bind('runRoute', function () {
  console.log('just about to run a route!')
})</code></pre>

<p>   </p>
</td>
<td class="code">
<pre><code><span class="variable">bind</span>: <span class="keyword">function</span> (<span class="variable">eventName</span>, <span class="variable">callback</span>) {
    <span class="keyword">if</span> (!<span class="this">this</span>.<span class="variable">_callbacks</span>[<span class="variable">eventName</span>]) <span class="this">this</span>.<span class="variable">_callbacks</span>[<span class="variable">eventName</span>] = [];
    <span class="this">this</span>.<span class="variable">_callbacks</span>[<span class="variable">eventName</span>].<span class="variable">push</span>(<span class="variable">callback</span>);
    <span class="keyword">return</span> <span class="this">this</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>app.trigger</h2>

<p>Triggers an event on the current object.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  eventName</p></li><li><p><strong>param</strong>: <em>Object</em>  data (optional)</p></li></ul>

<p>Triggers an event on the current object, all callbacks bound using bind will be called.
An optional second param can be passed which will be passed as an argument to each callback
bound to the named event.</p>

<h3>Example:</h3>

<pre><code>app.triger('foo')
app.trigger('bar', {baz: true})</code></pre>

<p>   </p>
</td>
<td class="code">
<pre><code><span class="variable">trigger</span>: <span class="keyword">function</span> (<span class="variable">eventName</span>) {
    <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
    <span class="keyword">var</span> <span class="variable">args</span> = <span class="variable">arguments</span>;
    <span class="keyword">if</span> (!<span class="this">this</span>.<span class="variable">_callbacks</span>[<span class="variable">eventName</span>]) <span class="this">this</span>.<span class="variable">_callbacks</span>[<span class="variable">eventName</span>] = [];
    <span class="class">Davis</span>.<span class="variable">utils</span>.<span class="variable">forEach</span>(<span class="this">this</span>.<span class="variable">_callbacks</span>[<span class="variable">eventName</span>], <span class="keyword">function</span> (<span class="variable">callback</span>) {
      <span class="variable">callback</span>.<span class="variable">apply</span>(<span class="variable">self</span>, <span class="class">Davis</span>.<span class="variable">utils</span>.<span class="variable">toArray</span>(<span class="variable">args</span>, <span class="number integer">1</span>));
    }) 
    <span class="keyword">return</span> <span class="this">this</span>;
  }
};

</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="src/davis.history.js"><a href="#">davis.history</a></h2></td><td>src/davis.history.js</td></tr><tr class="code">
<td class="docs">
<p>A module to normalize and enhance the window.pushState method and window.onpopstate event.
Adds the ability to bind to whenever a new state is pushed onto the history stack and normalizes
both of these events into an onChange event.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Davis</span>.<span class="variable">history</span> = (<span class="keyword">function</span> () {</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>Davis.history.onChange</h2>

<p>Bind to the history on change event.  This is not a native event but is fired any time a new
state is pushed onto the history stack, the current history is replaced or a state is popped
off the history stack.</p>

<h2></h2>

<ul><li><strong>param</strong>: <em>Function</em>  handler</li></ul>

<p>The handler function will be called with a request param which is an instance of Davis.Request.
 - <strong>see</strong>: <em>Davis</em>
.Request
   </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">onChange</span> = <span class="keyword">function</span> (<span class="variable">handler</span>) {
    <span class="variable">onPushState</span>(<span class="variable">handler</span>);
    <span class="variable">onPopState</span>(<span class="variable">wrapped</span>(<span class="variable">handler</span>));
  };</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>Davis.history.assign</h2>

<p>Push a request onto the history stack.  This is used internally by Davis to push a new request
resulting from either a form submit or a link click onto the history stack, it will also trigger
the onpushstate event.</p>

<h2></h2>

<ul><li><strong>param</strong>: <em>Davis.Request</em>  request</li></ul>

<p>An instance of Davis.Request is expected to be passed, however any object that has a title
and a path property will also be accepted.
   </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">assign</span> = <span class="keyword">function</span> (<span class="variable">request</span>) {
    <span class="variable">history</span>.<span class="variable">pushState</span>(<span class="variable">request</span>.<span class="variable">asJSON</span>(), <span class="variable">request</span>.<span class="variable">title</span>, <span class="variable">request</span>.<span class="variable">location</span>());
    <span class="class">Davis</span>.<span class="variable">utils</span>.<span class="variable">forEach</span>(<span class="variable">pushStateHandlers</span>, <span class="keyword">function</span> (<span class="variable">handler</span>) {
      <span class="variable">handler</span>(<span class="variable">request</span>);
    });
  };</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>Davis.history.replace</h2>

<p>Replace the current state on the history stack.  This is used internally by Davis when performing
a redirect.  This will trigger an onpushstate event.</p>

<h2></h2>

<ul><li><strong>param</strong>: <em>Davis.Request</em>  request</li></ul>

<p>An instance of Davis.Request is expected to be passed, however any object that has a title
and a path property will also be accepted.
   </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">replace</span> = <span class="keyword">function</span> (<span class="variable">request</span>) {
    <span class="variable">history</span>.<span class="variable">replaceState</span>(<span class="variable">request</span>.<span class="variable">asJSON</span>(), <span class="variable">request</span>.<span class="variable">title</span>, <span class="variable">request</span>.<span class="variable">location</span>());
    <span class="class">Davis</span>.<span class="variable">utils</span>.<span class="variable">forEach</span>(<span class="variable">pushStateHandlers</span>, <span class="keyword">function</span> (<span class="variable">handler</span>) {
      <span class="variable">handler</span>(<span class="variable">request</span>);
    });
  };</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>Davis.history.current</h2>

<p>Returns the current location for the application.
Davis.location delegates to this method for getting the apps current location.
   </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">current</span> = <span class="keyword">function</span> () {
    <span class="keyword">return</span> <span class="variable">window</span>.<span class="variable">location</span>.<span class="variable">pathname</span>
  }</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="src/davis.listener.js"><a href="#">davis.listener</a></h2></td><td>src/davis.listener.js</td></tr><tr class="code">
<td class="docs">
<p>A module to bind to link clicks and form submits and turn what would normally be http requests
into instances of Davis.Request.  These request objects are then pushed onto the history stack
using the Davis.history module.</p>

<p>This module requires jQuery for its event binding and event object normalization.  To use Davis
with any, or no, JavaScript framework this module should be replaced with one using your framework
of choice.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Davis</span>.<span class="variable">listener</span> = (<span class="keyword">function</span> () {</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>app.listen</h2>

<p>Binds to both link clicks and form submits using jQuery's deleagate.  Will catch all current
and future links and forms.  Uses the apps settings for the selector to use for links and forms</p>

<ul><li><strong>see</strong>: <em>Davis</em>
.App.settings</li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">listen</span> = <span class="keyword">function</span> () {
    <span class="variable">jQuery</span>(<span class="variable">document</span>).<span class="variable">delegate</span>(<span class="this">this</span>.<span class="variable">settings</span>.<span class="variable">formSelector</span>, <span class="string">'submit'</span>, <span class="variable">submitHandler</span>)
    <span class="variable">jQuery</span>(<span class="variable">document</span>).<span class="variable">delegate</span>(<span class="this">this</span>.<span class="variable">settings</span>.<span class="variable">linkSelector</span>, <span class="string">'click'</span>, <span class="variable">clickHandler</span>)
  }</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>app.unlisten</h2>

<p>Unbinds all click and submit handlers that were attatched with listen.  Will efectivley stop
the current app from processing any requests and all links and forms will have their default
behaviour restored.</p>

<ul><li><strong>see</strong>: <em>Davis</em>
.App.settings</li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">unlisten</span> = <span class="keyword">function</span> () {
    <span class="variable">jQuery</span>(<span class="variable">document</span>).<span class="variable">undelegate</span>(<span class="this">this</span>.<span class="variable">settings</span>.<span class="variable">linkSelector</span>, <span class="string">'click'</span>, <span class="variable">clickHandler</span>)
    <span class="variable">jQuery</span>(<span class="variable">document</span>).<span class="variable">undelegate</span>(<span class="this">this</span>.<span class="variable">settings</span>.<span class="variable">formSelector</span>, <span class="string">'submit'</span>, <span class="variable">submitHandler</span>)
  }</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="src/davis.location.js"><a href="#">davis.location</a></h2></td><td>src/davis.location.js</td></tr><tr class="code">
<td class="docs">
<p>A module that acts as a delegator to any locationDelegate implementation.  This abstracts the details of
what is being used for the apps routing away from the rest of the library.  This allows any kind of routing
To be used with Davis as long as it can respond appropriatly to the given delegate methods.</p>

<p>A routing module must respond to the following methods:</p>

<p> <strong>current</strong> : Should return the current location for the app</p>

<p> <strong>assign</strong> : Should set the current location of the app based on the location of the passed request.</p>

<p> <strong>replace</strong> : Should at least change the current location to the location of the passed request, for full compatibility it should not add any extra items in the history stack.</p>

<p> <strong>onChange</strong> : Should add calbacks that will be fired whenever the location is changed.</p>

<p> </p>
</td>
<td class="code">
<pre><code><span class="class">Davis</span>.<span class="variable">location</span> = (<span class="keyword">function</span> () {</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>By default the Davis uses the Davis.history module for its routing, this gives HTML5 based pushState routing
which is preferrable over location.hash based routing.
   </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">locationDelegate</span> = <span class="class">Davis</span>.<span class="variable">history</span></code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>Davis.location.setLocationDelegate</h2>

<p>Used to change the location delegate.  The passed delegate will be used for all Davis apps.  The delegate
must respond to the following four methods <code>current</code>, <code>assign</code>, <code>replace</code> &amp; <code>onChange</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  the location delegate to use.</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">setLocationDelegate</span> = <span class="keyword">function</span> (<span class="variable">delegate</span>) {
    <span class="variable">locationDelegate</span> = <span class="variable">delegate</span>
  }</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>Davis.location.current</h2>

<p>Delegates to the locationDelegate.current method.  This should return the current location of the app.
   </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">current</span> = <span class="keyword">function</span> () {
    <span class="keyword">return</span> <span class="variable">locationDelegate</span>.<span class="variable">current</span>()
  }</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>Davis.location.assign</h2>

<p>Delegates to the locationDelegate.assign method.  This should set the current location for the app to
that of the passed request object.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Request</em>  the request to set the current location to.</p></li><li><p><strong>see</strong>: <em>Davis</em>
.Request</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">assign</span> = <span class="keyword">function</span> (<span class="variable">req</span>) {
    <span class="variable">locationDelegate</span>.<span class="variable">assign</span>(<span class="variable">req</span>)
  }</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>Davis.location.replace</h2>

<p>Delegates to the locationDelegate.replace method.  This should replace the current location with that
of the passed request.  Ideally it should not create a new entry in the browsers history.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Request</em>  the request to replace the current location with.</p></li><li><p><strong>see</strong>: <em>Davis</em>
.Request</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">replace</span> = <span class="keyword">function</span> (<span class="variable">req</span>) {
    <span class="variable">locationDelegate</span>.<span class="variable">replace</span>(<span class="variable">req</span>)
  }</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>Davis.location.onChange</h2>

<p>Delegates to the locationDelegate.onChange method.  This should add a callback that will be called any
time the location changes.  The handler function will be called with a request param which is an
instance of Davis.Request.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Function</em>  callback function to be called on location chnage.</p></li><li><p><strong>see</strong>: <em>Davis</em>
.Request</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">onChange</span> = <span class="keyword">function</span> (<span class="variable">handler</span>) {
    <span class="variable">locationDelegate</span>.<span class="variable">onChange</span>(<span class="variable">handler</span>)
  }</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="src/davis.logger.js"><a href="#">davis.logger</a></h2></td><td>src/davis.logger.js</td></tr><tr class="code">
<td class="docs">
<p>A module for enhancing the standard logging available through the console object.
Used internally in Davis and available for use outside of Davis.</p>

<p>Generates log messages of varying severity in the format:</p>

<p><code>[Sun Jan 23 2011 16:15:21 GMT+0000 (GMT)] &lt;message&gt;</code>
 </p>
</td>
<td class="code">
<pre><code><span class="class">Davis</span>.<span class="variable">logger</span> = (<span class="keyword">function</span> () {</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>Davis.logger.error</h2>

<p>Prints an error message to the console if the console is available.</p>

<h2></h2>

<ul><li><p><strong>params</strong>: <em>String</em>  All arguments are combined and logged to the console.</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">error</span> = <span class="keyword">function</span> () {
    <span class="keyword">if</span> (<span class="variable">window</span>.<span class="variable">console</span>) <span class="variable">console</span>.<span class="variable">error</span>(<span class="variable">prepArgs</span>(<span class="variable">arguments</span>));
  }</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>Davis.logger.info</h2>

<p>Prints an info message to the console if the console is available.</p>

<h2></h2>

<ul><li><p><strong>params</strong>: <em>String</em>  All arguments are combined and logged to the console.</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">info</span> = <span class="keyword">function</span> () {
    <span class="keyword">if</span> (<span class="variable">window</span>.<span class="variable">console</span>) <span class="variable">console</span>.<span class="variable">info</span>(<span class="variable">prepArgs</span>(<span class="variable">arguments</span>));
  }</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>Davis.logger.warn</h2>

<p>Prints a warning message to the console if the console is available.</p>

<h2></h2>

<ul><li><p><strong>params</strong>: <em>String</em>  All arguments are combined and logged to the console.</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">warn</span> = <span class="keyword">function</span> () {
    <span class="keyword">if</span> (<span class="variable">window</span>.<span class="variable">console</span>) <span class="variable">console</span>.<span class="variable">warn</span>(<span class="variable">prepArgs</span>(<span class="variable">arguments</span>));
  }</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="src/davis.request.js"><a href="#">davis.request</a></h2></td><td>src/davis.request.js</td></tr><tr class="code">
<td class="docs">
<p>Daivs.Requests are created from click and submit events.  Davis.Requests are passed to Davis.Routes
and are stored in the history stack.  They are instantiated by the Davis.listener module.</p>

<p>A request will have a params object which will contain all query params and form params, any named
params in a routes path will also be added to the requests params object.  Also included is support
for rails style nested form params.</p>

<p>By default the request method will be taken from the method attribute for forms or will be defaulted
to 'get' for links, however there is support for using a hidden field called _method in your forms
to set the correct reqeust method.</p>

<ul><li><strong>constructo</strong>: <em>r</em></li></ul>

<h2></h2>

<ul><li><strong>param</strong>: <em>Object</em>  raw An object that at least contains a title, fullPath and method proprty.</li></ul>

<h3>Example:</h3>

<pre><code>var request = new Davis.Request({
  title: "foo",
  fullPath: "/foo/12",
  method: "get"
})</code></pre>

<p> </p>
</td>
<td class="code">
<pre><code><span class="class">Davis</span>.<span class="class">Request</span> = <span class="keyword">function</span> (<span class="variable">raw</span>) {
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
  <span class="this">this</span>.<span class="variable">raw</span> = <span class="variable">raw</span>;
  <span class="this">this</span>.<span class="variable">params</span> = {};
  <span class="this">this</span>.<span class="variable">title</span> = <span class="variable">raw</span>.<span class="variable">title</span>;
  <span class="this">this</span>.<span class="variable">queryString</span> = <span class="variable">raw</span>.<span class="variable">fullPath</span>.<span class="variable">split</span>(&<span class="variable">quot</span>;?&<span class="variable">quot</span>;)[<span class="number integer">1</span>];
  <span class="this">this</span>.<span class="variable">_staleCallback</span> = <span class="keyword">function</span> () {};

  <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">queryString</span>) {
    <span class="class">Davis</span>.<span class="variable">utils</span>.<span class="variable">forEach</span>(<span class="this">this</span>.<span class="variable">queryString</span>.<span class="variable">split</span>(&<span class="variable">quot</span>;&<span class="variable">amp</span>;&<span class="variable">quot</span>;), <span class="keyword">function</span> (<span class="variable">keyval</span>) {
      <span class="keyword">var</span> <span class="variable">paramName</span> = <span class="variable">keyval</span>.<span class="variable">split</span>(&<span class="variable">quot</span>;=&<span class="variable">quot</span>;)[<span class="number integer">0</span>],
          <span class="variable">paramValue</span> = <span class="variable">keyval</span>.<span class="variable">split</span>(&<span class="variable">quot</span>;=&<span class="variable">quot</span>;)[<span class="number integer">1</span>],
          <span class="variable">nestedParamRegex</span> = <span class="regexp">/^(\w+)\[(\w+)\]/</span>,
          <span class="variable">nested</span>;

      <span class="keyword">if</span> (<span class="variable">nested</span> = <span class="variable">nestedParamRegex</span>.<span class="variable">exec</span>(<span class="variable">paramName</span>)) {
        <span class="keyword">var</span> <span class="variable">paramParent</span> = <span class="variable">nested</span>[<span class="number integer">1</span>];
        <span class="keyword">var</span> <span class="variable">paramName</span> = <span class="variable">nested</span>[<span class="number integer">2</span>];
        <span class="keyword">var</span> <span class="variable">parentParams</span> = <span class="variable">self</span>.<span class="variable">params</span>[<span class="variable">paramParent</span>] || {};
        <span class="variable">parentParams</span>[<span class="variable">paramName</span>] = <span class="variable">paramValue</span>;
        <span class="variable">self</span>.<span class="variable">params</span>[<span class="variable">paramParent</span>] = <span class="variable">parentParams</span>;
      } <span class="keyword">else</span> {
        <span class="variable">self</span>.<span class="variable">params</span>[<span class="variable">paramName</span>] = <span class="variable">paramValue</span>;
      };

    });
  };

  <span class="this">this</span>.<span class="variable">method</span> = (<span class="this">this</span>.<span class="variable">params</span>.<span class="variable">_method</span> || <span class="variable">raw</span>.<span class="variable">method</span>).<span class="variable">toLowerCase</span>();
  <span class="this">this</span>.<span class="variable">path</span> = <span class="variable">raw</span>.<span class="variable">fullPath</span>.<span class="variable">replace</span>(<span class="regexp">/\?.+$/</span>, &<span class="variable">quot</span>;&<span class="variable">quot</span>;);
  <span class="this">this</span>.<span class="variable">delegateToServer</span> = <span class="variable">raw</span>.<span class="variable">delegateToServer</span> || <span class="class">Davis</span>.<span class="variable">noop</span>;
  <span class="this">this</span>.<span class="variable">isForPageLoad</span> = <span class="variable">raw</span>.<span class="variable">forPageLoad</span> || <span class="variable">false</span>;

  <span class="keyword">if</span> (<span class="class">Davis</span>.<span class="class">Request</span>.<span class="variable">prev</span>) <span class="class">Davis</span>.<span class="class">Request</span>.<span class="variable">prev</span>.<span class="variable">makeStale</span>(<span class="this">this</span>);
  <span class="class">Davis</span>.<span class="class">Request</span>.<span class="variable">prev</span> = <span class="this">this</span>;

};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>request.redirect</h2>

<p>Redirects the current request to a new location.  Calling redirect on an instance of
Davis.Request will create a new request using the path and title of the current request.
Redirected requests always have a method of 'get'</p>

<p>The request created will replace the current request in the history stack.  Redirect is most
often useful inside a handler for a form submit.  After succesfully handling the form the app
can redirect to another path.  This means that the current form will not be re-submitted if
navigating through the history with the back or forward buttons because the request that the
submit generated has been replaced in the history stack.</p>

<h2></h2>

<ul><li><strong>param</strong>: <em>String</em>  path The path to redirect the current request to</li></ul>

<h3>Example:</h3>

<pre><code>this.post('/foo', function (req) {
  processFormRequest(req.params)  // do something with the form request
  req.redirect('/bar');
})</code></pre>

<p> </p>
</td>
<td class="code">
<pre><code><span class="class">Davis</span>.<span class="class">Request</span>.<span class="variable">prototype</span>.<span class="variable">redirect</span> = <span class="keyword">function</span> (<span class="variable">path</span>) {
  <span class="class">Davis</span>.<span class="variable">location</span>.<span class="variable">replace</span>(<span class="keyword">new</span> <span class="class">Davis</span>.<span class="class">Request</span> ({
    <span class="variable">method</span>: <span class="string">'get'</span>,
    <span class="variable">fullPath</span>: <span class="variable">path</span>,
    <span class="variable">title</span>: <span class="this">this</span>.<span class="variable">title</span>
  }));
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>request.whenStale</h2>

<p>Adds a callback to be called when the request is stale.  A request becomes stale when it is no
longer the current request, this normally occurs when a new request is triggered.  A request 
can be marked as stale manually if required.  The callback passed to whenStale will be called
with the new request that is making the current request stale.</p>

<p>Use the whenStale callback to 'teardown' the objects required for the current route, this gives
a chance for views to hide themselves and unbind any event handlers etc.</p>

<h2></h2>

<ul><li><strong>param</strong>: <em>Function</em>  callback A single callback that will be called when the request becomes stale.</li></ul>

<h3>Example:</h3>

<pre><code>this.get('/foo', function (req) {
  var fooView = new FooView ()
  fooView.render() // display the foo view
  req.whenStale(function (nextReq) {
    fooView.remove() // stop displaying foo view and unbind any events
  })
})</code></pre>

<p> </p>
</td>
<td class="code">
<pre><code><span class="class">Davis</span>.<span class="class">Request</span>.<span class="variable">prototype</span>.<span class="variable">whenStale</span> = <span class="keyword">function</span> (<span class="variable">callback</span>) {
  <span class="this">this</span>.<span class="variable">_staleCallback</span> = <span class="variable">callback</span>;
}</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>request.makeStale</h2>

<p>Mark the request as stale.  This will cause the whenStale callback to be called.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Davis.Request</em>  req The next request that has been recieved.</p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Davis</span>.<span class="class">Request</span>.<span class="variable">prototype</span>.<span class="variable">makeStale</span> = <span class="keyword">function</span> (<span class="variable">req</span>) {
  <span class="this">this</span>.<span class="variable">_staleCallback</span>.<span class="variable">call</span>(<span class="variable">req</span>, <span class="variable">req</span>);
}</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>request.location</h2>

<p>Returns the location or path that should be pushed onto the history stack, for get requests this
will be the same as the path, for post, put, delete and state requests this will be blank as no
location should be pushed onto the history stack.</p>

<h2></h2>

<ul><li><p><strong>returns</strong>: <em>String</em>  string The location that the url bar should display and should be pushed onto the history stack for this request.</p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Davis</span>.<span class="class">Request</span>.<span class="variable">prototype</span>.<span class="variable">location</span> = <span class="keyword">function</span> () {
  <span class="keyword">return</span> (<span class="this">this</span>.<span class="variable">method</span> === <span class="string">'get'</span>) ? <span class="this">this</span>.<span class="variable">path</span> : <span class="string">''</span>
}</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>request.toString</h2>

<p>Converts the request to a string representation of itself by combining the method and path
attributes.</p>

<h2></h2>

<ul><li><p><strong>returns</strong>: <em>String</em>  string representation of the request</p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Davis</span>.<span class="class">Request</span>.<span class="variable">prototype</span>.<span class="variable">toString</span> = <span class="keyword">function</span> () {
  <span class="keyword">return</span> [<span class="this">this</span>.<span class="variable">method</span>.<span class="variable">toUpperCase</span>(), <span class="this">this</span>.<span class="variable">path</span>].<span class="variable">join</span>(&<span class="variable">quot</span>; &<span class="variable">quot</span>;)
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>request.asJSON</h2>

<p>Converts the request to a plain object which can be converted to a JSON string.  Used when
pushing a request onto the history stack.</p>

<h2></h2>

<ul><li><p><strong>returns</strong>: <em>Object</em>  a plain object representation of the request.</p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Davis</span>.<span class="class">Request</span>.<span class="variable">prototype</span>.<span class="variable">asJSON</span> = <span class="keyword">function</span> () {
  <span class="keyword">return</span> {
    <span class="variable">title</span>: <span class="this">this</span>.<span class="variable">raw</span>.<span class="variable">title</span>,
    <span class="variable">fullPath</span>: <span class="this">this</span>.<span class="variable">raw</span>.<span class="variable">fullPath</span>,
    <span class="variable">method</span>: <span class="this">this</span>.<span class="variable">raw</span>.<span class="variable">method</span>
  }
}</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>Davis.Request.forPageLoad</h2>

<p>Creates a new request for the page on page load.
This is required because usually requests are generated from clicking links or submitting forms
however this doesn't happen on a page load but should still be considered a request that the 
JavaScript app should handle.</p>

<h2></h2>

<ul><li><p><strong>returns</strong>: <em>Davis.Request</em>  A request representing the current page loading.</p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Davis</span>.<span class="class">Request</span>.<span class="variable">forPageLoad</span> = <span class="keyword">function</span> () {
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="this">this</span> ({
    <span class="variable">method</span>: <span class="string">'get'</span>,
    <span class="comment">// fullPath: window.location.pathname,</span>
    <span class="variable">fullPath</span>: <span class="class">Davis</span>.<span class="variable">location</span>.<span class="variable">current</span>(),
    <span class="variable">title</span>: <span class="variable">document</span>.<span class="variable">title</span>,
    <span class="variable">forPageLoad</span>: <span class="variable">true</span>
  });
}</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="src/davis.route.js"><a href="#">davis.route</a></h2></td><td>src/davis.route.js</td></tr><tr class="code">
<td class="docs">
<p>Davis.Routes are the main part of a Davis application.  They consist of a HTTP method, a path
and a callback function.  When a link or a form that Davis has bound to are clicked or submitted
a request is pushed on the history stack and a route that matches the path and method of the
generated request is run.</p>

<p>Inside the callback function 'this' is bound to the request.</p>

<ul><li><strong>constructo</strong>: <em>r</em></li></ul>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  method - This should be one of either 'get', 'post', 'put', 'delete', 'before', 'after' or 'state'</p></li><li><p><strong>param</strong>: <em>String</em>  path - This string can contain place holders for variables, e.g. '/user/:id'</p></li><li><p><strong>param</strong>: <em>Function</em>  callback - A callback that will be called when a request matching both the path and method is triggered.</p></li></ul>

<h3>Example:</h3>

<pre><code>var route = new Davis.Route ('get', '/foo/:id', function (req) {
  var id = req.params['id']
  // do something interesting!
})</code></pre>

<p> </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Route</span> = <span class="keyword">function</span> (<span class="variable">method</span>, <span class="variable">path</span>, <span class="variable">callback</span>) {
    <span class="keyword">var</span> <span class="variable">convertPathToRegExp</span> = <span class="keyword">function</span> () {
      <span class="keyword">if</span> (!(<span class="variable">path</span> <span class="variable">instanceof</span> <span class="class">RegExp</span>)) {
        <span class="keyword">var</span> <span class="variable">str</span> = <span class="variable">path</span>.<span class="variable">replace</span>(<span class="variable">pathNameRegex</span>, <span class="variable">pathNameReplacement</span>);

        <span class="comment">// Most browsers will reset this to zero after a replace call.  IE will</span>
        <span class="comment">// set it to the index of the last matched character.</span>
        <span class="variable">path</span>.<span class="variable">lastIndex</span> = <span class="number integer">0</span>;

        <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">RegExp</span>(&<span class="variable">quot</span>;^&<span class="variable">quot</span>; + <span class="variable">str</span> + &<span class="variable">quot</span>;$&<span class="variable">quot</span>;, &<span class="variable">quot</span>;<span class="variable">gi</span>&<span class="variable">quot</span>;);
      } <span class="keyword">else</span> {
        <span class="keyword">return</span> <span class="variable">path</span>;
      };
    };

    <span class="keyword">var</span> <span class="variable">convertMethodToRegExp</span> = <span class="keyword">function</span> () {
      <span class="keyword">if</span> (!(<span class="variable">method</span> <span class="variable">instanceof</span> <span class="class">RegExp</span>)) {
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">RegExp</span>(&<span class="variable">quot</span>;^&<span class="variable">quot</span>; + <span class="variable">method</span> + &<span class="variable">quot</span>;$&<span class="variable">quot</span>;, &<span class="variable">quot</span>;<span class="variable">i</span>&<span class="variable">quot</span>;);
      } <span class="keyword">else</span> {
        <span class="keyword">return</span> <span class="variable">method</span>
      };
    }

    <span class="keyword">var</span> <span class="variable">capturePathParamNames</span> = <span class="keyword">function</span> () {
      <span class="keyword">var</span> <span class="variable">names</span> = [], <span class="variable">a</span>;
      <span class="keyword">while</span> ((<span class="variable">a</span> = <span class="variable">pathNameRegex</span>.<span class="variable">exec</span>(<span class="variable">path</span>))) <span class="variable">names</span>.<span class="variable">push</span>(<span class="variable">a</span>[<span class="number integer">1</span>]);
      <span class="keyword">return</span> <span class="variable">names</span>;
    };

    <span class="this">this</span>.<span class="variable">paramNames</span> = <span class="variable">capturePathParamNames</span>();
    <span class="this">this</span>.<span class="variable">path</span> = <span class="variable">convertPathToRegExp</span>();
    <span class="this">this</span>.<span class="variable">method</span> = <span class="variable">convertMethodToRegExp</span>();
    <span class="this">this</span>.<span class="variable">callback</span> = <span class="variable">callback</span>;
  }

  <span class="class">Route</span>.<span class="variable">prototype</span> = {</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>route.match</h2>

<p>Tests whether or not a route matches a particular request.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  method</p></li><li><p><strong>param</strong>: <em>String</em>  path</p></li><li><p><strong>returns</strong>: <em>Boolean</em> </p></li></ul>

<h3>Example:</h3>

<pre><code>route.match('get', '/foo/12')
 </code></pre>
</td>
<td class="code">
<pre><code><span class="variable">match</span>: <span class="keyword">function</span> (<span class="variable">method</span>, <span class="variable">path</span>) {
      <span class="this">this</span>.<span class="variable">reset</span>();
      <span class="keyword">return</span> (<span class="this">this</span>.<span class="variable">method</span>.<span class="variable">test</span>(<span class="variable">method</span>)) &<span class="variable">amp</span>;&<span class="variable">amp</span>; (<span class="this">this</span>.<span class="variable">path</span>.<span class="variable">test</span>(<span class="variable">path</span>))
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>route.reset</h2>

<p>Resets the RegExps for method and path
     </p>
</td>
<td class="code">
<pre><code><span class="variable">reset</span>: <span class="keyword">function</span> () {
       <span class="this">this</span>.<span class="variable">method</span>.<span class="variable">lastIndex</span> = <span class="number integer">0</span>;
       <span class="this">this</span>.<span class="variable">path</span>.<span class="variable">lastIndex</span> = <span class="number integer">0</span>;
     },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>route.run</h2>

<p>Runs the callback associated with a particular route against the passed request.
Any named params in the request path are extracted, as per the routes path, and
added onto the requests params object.</p>

<h2></h2>

<ul><li><p><strong>params</strong>: <em>Davis.Request</em>  request</p></li><li><p><strong>returns</strong>: <em>Object</em>  whatever the routes callback returns</p></li></ul>

<h3>Example:</h3>

<pre><code>route.run(request)
 </code></pre>
</td>
<td class="code">
<pre><code><span class="variable">run</span>: <span class="keyword">function</span> (<span class="variable">request</span>) {
      <span class="this">this</span>.<span class="variable">reset</span>();
      <span class="keyword">var</span> <span class="variable">matches</span> = <span class="this">this</span>.<span class="variable">path</span>.<span class="variable">exec</span>(<span class="variable">request</span>.<span class="variable">path</span>);
      <span class="keyword">if</span> (<span class="variable">matches</span>) {
        <span class="variable">matches</span>.<span class="variable">shift</span>();
        <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">i</span> &<span class="variable">lt</span>; <span class="variable">matches</span>.<span class="variable">length</span>; <span class="variable">i</span>++) {
          <span class="variable">request</span>.<span class="variable">params</span>[<span class="this">this</span>.<span class="variable">paramNames</span>[<span class="variable">i</span>]] = <span class="variable">matches</span>[<span class="variable">i</span>];
        };
      };
      <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">callback</span>.<span class="variable">call</span>(<span class="variable">request</span>, <span class="variable">request</span>);
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>route.toString</h2>

<p>Converts the route to a string representation of itself by combining the method and path
attributes.</p>

<h2></h2>

<ul><li><p><strong>returns</strong>: <em>String</em>  string representation of the route</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">toString</span>: <span class="keyword">function</span> () {
      <span class="keyword">return</span> [<span class="this">this</span>.<span class="variable">method</span>, <span class="this">this</span>.<span class="variable">path</span>].<span class="variable">join</span>(<span class="string">' '</span>);
    }
  };</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="src/davis.router.js"><a href="#">davis.router</a></h2></td><td>src/davis.router.js</td></tr><tr class="code">
<td class="docs">
<p>A decorator that adds convinience methods to a Davis.App for easily creating instances
of Davis.Route and looking up routes for a particular request.</p>

<p>Provides get, post put and delete method shortcuts for creating instances of Davis.Routes
with the corresponding method.  This allows simple REST styled routing for a client side
JavaScript application.</p>

<h3>Example</h3>

<pre><code>app.get('/foo/:id', function (req) {
  // get the foo with id = req.params['id']
})

app.post('/foo', function (req) {
  // create a new instance of foo with req.params
})

app.put('/foo/:id', function (req) {
  // update the instance of foo with id = req.params['id']
})

app.del('/foo/:id', function (req) {
  // delete the instance of foo with id = req.params['id']
})</code></pre>

<p>As well as providing convinience methods for creating instances of Davis.Routes the router
also provides methods for creating special instances of routes called filters.  Before filters
run before any matching route is run, and after filters run after any matched route has run.
A before filter can return false to halt the running of any matched routes or other before filters.</p>

<p>A filter can take an optional path to match on, or without a path will match every request.</p>

<h3>Example</h3>

<pre><code>app.before('/foo/:id', function (req) {
  // will only run before request matching '/foo/:id'
})

app.before(function (req) {
  // will run before all routes
})

app.after('/foo/:id', function (req) {
  // will only run after routes matching '/foo/:id'
})

app.after(function (req) {
  // will run after all routes
})</code></pre>

<p>Another special kind of route, called state routes, are also generated using the router.  State routes
are for requests that will not change the current page location.  Instead the page location will remain
the same but the current state of the page has changed.  This allows for states which the server will not
be expected to know about and support.</p>

<h3>Example</h3>

<pre><code>app.state('/foo/:id', function (req) {
  // will run when the app transitions into the '/foo/:id' state.
})</code></pre>

<p>Using the <code>trans</code> method an app can transition to these kind of states without changing the url location.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Davis</span>.<span class="variable">router</span> = <span class="keyword">function</span> () {
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span></code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>app.get, app.post, app.put</h2>

<p>Generating convinience methods for creating Davis.Routes
   </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">verbs</span> = [<span class="string">'get'</span>, <span class="string">'post'</span>, <span class="string">'put'</span>];
  <span class="class">Davis</span>.<span class="variable">utils</span>.<span class="variable">forEach</span>(<span class="variable">verbs</span>, <span class="keyword">function</span> (<span class="variable">verb</span>) {
    <span class="variable">self</span>[<span class="variable">verb</span>] = <span class="keyword">function</span> (<span class="variable">path</span>, <span class="variable">handler</span>) {
      <span class="variable">self</span>.<span class="variable">_routeCollection</span>.<span class="variable">push</span>(<span class="keyword">new</span> <span class="class">Davis</span>.<span class="class">Route</span> (<span class="variable">verb</span>, <span class="variable">path</span>, <span class="variable">handler</span>));
    }
  })</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>app.del</h2>

<p>delete is a reserved word in javascript so use the <code>del</code> method to
creating a Davis.Route with a method of delete.
   </p>
</td>
<td class="code">
<pre><code><span class="this">this</span>.<span class="variable">del</span> = <span class="keyword">function</span> (<span class="variable">path</span>, <span class="variable">handler</span>) {
    <span class="variable">self</span>.<span class="variable">_routeCollection</span>.<span class="variable">push</span>(<span class="keyword">new</span> <span class="class">Davis</span>.<span class="class">Route</span> (<span class="string">'delete'</span>, <span class="variable">path</span>, <span class="variable">handler</span>))
  }</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>app.state</h2>

<p>Adds a state route into the apps route collection.  These special kind of routes are not triggered
by clicking links or submitting forms, instead they are triggered manually by calling <code>trans</code>.</p>

<p>Routes added using the state method act in the same way as other routes except that they generate
a route that is listening for requests that will not change the page location.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  path The path for this route, this will never be seen in the url bar.</p></li><li><p><strong>param</strong>: <em>Function</em>  handler The handler for this route, will be called with the request that triggered the route</p></li></ul>

<h3>Example</h3>

<pre><code>app.state('/foo/:id', function (req) {
  // will run when the app transitions into the '/foo/:id' state.
})</code></pre>

<p>   </p>
</td>
<td class="code">
<pre><code><span class="this">this</span>.<span class="variable">state</span> = <span class="keyword">function</span> (<span class="variable">path</span>, <span class="variable">handler</span>) {
    <span class="variable">self</span>.<span class="variable">_routeCollection</span>.<span class="variable">push</span>(<span class="keyword">new</span> <span class="class">Davis</span>.<span class="class">Route</span>(<span class="string">'state'</span>, <span class="variable">path</span>, <span class="variable">handler</span>))
  }</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>app.trans</h2>

<p>Transitions the app into the state identified by the passed path parameter.  This allows the app to
enter states without changing the page path through a link click or form submit.  If there are handlers
registered for this state, added by the <code>state</code> method, they will be triggered.</p>

<p>This method generates a request with a method of 'state', in all other ways this request is identical
to those that are generated when clicking links etc.</p>

<p>States transitioned to using this method will not be able to be revisited directly with a page load as
there is no url that represents the state.</p>

<p>An optional second parameter can be passed which will be available to any handlers in the requests
params object.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  path The path that represents this state.  This will not be seen in the url bar.</p></li><li><p><strong>param</strong>: <em>Object</em>  data Any additional data that should be sent with the request as params.</p></li></ul>

<h3>Example</h3>

<pre><code>app.trans('/foo/1')

app.trans('/foo/1', {
  "bar": "baz"
})</code></pre>

<p>   </p>
</td>
<td class="code">
<pre><code><span class="this">this</span>.<span class="variable">trans</span> = <span class="keyword">function</span> (<span class="variable">path</span>, <span class="variable">data</span>) {
    <span class="keyword">if</span> (<span class="variable">data</span>) {
      <span class="keyword">var</span> <span class="variable">fullPath</span> = [<span class="variable">path</span>, <span class="variable">decodeURIComponent</span>(<span class="variable">jQuery</span>.<span class="variable">param</span>(<span class="variable">data</span>))].<span class="variable">join</span>(<span class="string">'?'</span>)
    } <span class="keyword">else</span> {
      <span class="keyword">var</span> <span class="variable">fullPath</span> = <span class="variable">path</span>
    };

    <span class="keyword">var</span> <span class="variable">req</span> = <span class="keyword">new</span> <span class="class">Davis</span>.<span class="class">Request</span>({
      <span class="variable">method</span>: <span class="string">'state'</span>,
      <span class="variable">fullPath</span>: <span class="variable">fullPath</span>,
      <span class="variable">title</span>: <span class="string">''</span>
    })

    <span class="class">Davis</span>.<span class="variable">location</span>.<span class="variable">assign</span>(<span class="variable">req</span>)
  }</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Generating convinience methods for creating filters using Davis.Routes and methods to
lookup filters.
   </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">filters</span> = [<span class="string">'before'</span>, <span class="string">'after'</span>];
  <span class="class">Davis</span>.<span class="variable">utils</span>.<span class="variable">forEach</span>(<span class="variable">filters</span>, <span class="keyword">function</span> (<span class="variable">filter</span>) {
    <span class="variable">self</span>[<span class="variable">filter</span>] = <span class="keyword">function</span> () {
      <span class="keyword">var</span> <span class="variable">method</span> = <span class="regexp">/.+/</span>;

      <span class="keyword">if</span> (<span class="variable">arguments</span>.<span class="variable">length</span> == <span class="number integer">1</span>) {
        <span class="keyword">var</span> <span class="variable">path</span> = <span class="regexp">/.+/</span>;
        <span class="keyword">var</span> <span class="variable">handler</span> = <span class="variable">arguments</span>[<span class="number integer">0</span>];
      } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">arguments</span>.<span class="variable">length</span> == <span class="number integer">2</span>) {
        <span class="keyword">var</span> <span class="variable">path</span> = <span class="variable">arguments</span>[<span class="number integer">0</span>];
        <span class="keyword">var</span> <span class="variable">handler</span> = <span class="variable">arguments</span>[<span class="number integer">1</span>];
      };

      <span class="variable">self</span>.<span class="variable">_filterCollection</span>[<span class="variable">filter</span>].<span class="variable">push</span>(<span class="keyword">new</span> <span class="class">Davis</span>.<span class="class">Route</span> (<span class="variable">method</span>, <span class="variable">path</span>, <span class="variable">handler</span>));
    }

    <span class="keyword">var</span> <span class="variable">lookupName</span> = <span class="string">'lookup'</span> + <span class="variable">filter</span>.<span class="variable">replace</span>(<span class="regexp">/^\w/</span>, <span class="keyword">function</span> ($<span class="number integer">0</span>) { <span class="keyword">return</span> $<span class="number integer">0</span>.<span class="variable">toUpperCase</span>()}) + <span class="string">'Filter'</span>;

    <span class="variable">self</span>[<span class="variable">lookupName</span>] = <span class="keyword">function</span> (<span class="variable">method</span>, <span class="variable">path</span>) {
      <span class="keyword">return</span> <span class="class">Davis</span>.<span class="variable">utils</span>.<span class="variable">filter</span>(<span class="variable">self</span>.<span class="variable">_filterCollection</span>[<span class="variable">filter</span>], <span class="keyword">function</span> (<span class="variable">route</span>) {
        <span class="keyword">return</span> <span class="variable">route</span>.<span class="variable">match</span>(<span class="variable">method</span>, <span class="variable">path</span>)
      });
    }
  })</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>app.lookupRoute</h2>

<p>Looks for the first route that matches the method and path from a request.  Will only
find and return the first matched route.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  method</p></li><li><p><strong>param</strong>: <em>String</em>  path</p></li><li><p><strong>returns</strong>: <em>Davis.Route</em>  route</p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">self</span>.<span class="variable">lookupRoute</span> = <span class="keyword">function</span> (<span class="variable">method</span>, <span class="variable">path</span>) {
    <span class="keyword">return</span> <span class="class">Davis</span>.<span class="variable">utils</span>.<span class="variable">filter</span>(<span class="this">this</span>.<span class="variable">_routeCollection</span>, <span class="keyword">function</span> (<span class="variable">route</span>) {
      <span class="keyword">return</span> <span class="variable">route</span>.<span class="variable">match</span>(<span class="variable">method</span>, <span class="variable">path</span>)
    })[<span class="number integer">0</span>];
  };
}</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="src/davis.utils.js"><a href="#">davis.utils</a></h2></td><td>src/davis.utils.js</td></tr><tr class="code">
<td class="docs">
<p>A module that provides wrappers around modern JavaScript so that native implementations are used
whereever possible and JavaScript implementations are used in those browsers that do not natively
support them.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Davis</span>.<span class="variable">utils</span> = (<span class="keyword">function</span> () {</code></pre>
</td>
</tr>	</body>
</html></tbody></table>